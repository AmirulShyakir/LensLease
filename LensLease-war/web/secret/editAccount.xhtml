<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../defaultProfile.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="title">
        Edit Account | LensLease
    </ui:define>

    <ui:define name="content">
        <h:form id="form">
            <div class="px-3">
                <h2 class="mb-1">Edit my profile</h2>
            </div>
            <p:tabView>
                <p:tab title="Profile Details" id="profile">
                    <div>
                        <p:panelGrid columns="2" styleClass="ui-noborder">
                            <h:panelGroup >
                                <p:outputLabel>
                                    <h5>Name</h5>
                                </p:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h5><p:inputText id="name" value="#{accountManagedBean.user.name}"/></h5>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:outputLabel>
                                    <h5>Username</h5>
                                </p:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h5><p:inputText id="username" value="#{accountManagedBean.user.username}"/></h5>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:outputLabel>
                                    <h5>Email</h5>
                                </p:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h5><p:inputText id="email" value="#{accountManagedBean.user.email}"/></h5>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:outputLabel>
                                    <h5>Contact number</h5>
                                </p:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h5><p:inputText id="contactNumber" value="#{accountManagedBean.user.contactNumber}"/></h5>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:outputLabel>
                                    <h5>Profile picture URL</h5>
                                </p:outputLabel>
                            </h:panelGroup>
                            <h:panelGroup>
                                <h5><p:inputText id="profilePic" value="#{accountManagedBean.user.photoUrl}"/></h5>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:commandButton value="Cancel" style="width:100px;background: transparent;color:#568DF5; border-radius: 30px; border-color: #568DF5; font-size: 14px" action="editAccount.xhtml?faces-redirect=true"/>
                                <p:spacer width="10"/>
                                <p:commandButton value="Save" style="width:100px;background: #568DF5; border-radius: 30px; border: #568DF5; font-size: 14px" 
                                                 action="editAccount.xhtml?faces-redirect=true" ajax="false"
                                                 update="profile" actionListener="${accountManagedBean.saveDetails}"/>
                            </h:panelGroup>
                        </p:panelGrid>
                    </div>
                </p:tab>
                <p:tab title="Edit password" id="changePassword">
                    <p:panelGrid columns="2" styleClass="ui-noborder" >
                        <h:panelGroup>
                            <p:outputLabel>
                                <h5>Current password</h5>
                            </p:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup>
                            <h5><p:password id="currentPassword" value="#{accountManagedBean.currentPassword}" toggleMask="true" redisplay="true"/></h5>
                        </h:panelGroup> 
                        <h:panelGroup>
                            <p:outputLabel>
                                <h5>New password</h5>
                            </p:outputLabel>
                        </h:panelGroup>
                        <h:panelGroup>
                            <h5><p:password id="newPassword" value="#{accountManagedBean.newPassword}" toggleMask="true" redisplay="true"/></h5>
                        </h:panelGroup> 
                        <h:panelGroup>
                            <p:commandButton value="Cancel" style="background: transparent;color:#568DF5; border-radius: 30px; border-color: #568DF5; font-size: 14px" action="editAccount.xhtml?faces-redirect=true"/>
                            <p:spacer width="10"/>
                            <p:commandButton value="Submit" style="background: #568DF5; border-radius: 30px; border: #568DF5; font-size: 14px" 
                                             action="editAccount.xhtml?faces-redirect=true"
                                             update="changePassword" actionListener="${accountManagedBean.changePassword}"/>
                        </h:panelGroup>
                    </p:panelGrid>
                </p:tab>
            </p:tabView>
            <p:growl id="message" showDetail="true">
                <p:autoUpdate/>
            </p:growl>

        </h:form>
        <h:form id="dialogs">
            <p:dialog header="Update Image" showEffect="fade" modal="true" widgetVar="imageDialog" responsive="true">
                <p:outputPanel id="image-dialog" class="ui-fluid">
                    <p:outputPanel rendered="#{not empty accountManagedBean.user}">
                        <p:outputLabel for="link">Image URL</p:outputLabel>
                        <p:inputText id="link" value="#{accountManagedBean.user.photoUrl}" required="true" />
                    </p:outputPanel>
                </p:outputPanel>
                <f:facet name="footer">
                    <p:commandButton value="Save" icon="pi pi-check" actionListener="#{accountManagedBean.saveImage}"
                                     update="image-dialog" process="image-dialog @this" />
                    <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('imageDialog').hide()"
                                     class="ui-button-secondary" type="button" />
                </f:facet>
            </p:dialog>
        </h:form>
    </ui:define>

</ui:composition>
